let sameLocation=!1,enableRotationPointer;const width=window.innerWidth,height=window.innerHeight-150,config={speed:.035,verticalTilt:-30,horizontalTilt:3},md=new MobileDetect(window.navigator.userAgent);let locations=[{region:"California",latitude:"37.3860",longitude:"-122.0838"}],separatedLocation;function separateLoc(t){const[e,o]=t.loc.split(",");return{latitude:parseFloat(e),longitude:parseFloat(o),region:t.region}}fetch("https://ipinfo.io/json").then((t=>t.json())).then((t=>{separatedLocation=separateLoc(t),separatedLocation.region===locations[0].region?sameLocation=!0:(sameLocation=!1,locations.push(separatedLocation)),setup()})).catch((t=>{sameLocation=!1,console.log(t),setup()}));const svg=d3.select("svg").attr("width",width).attr("height",height),markerGroup=svg.append("g"),textGroup=svg.append("g"),projection=d3.geoOrthographic(),path=d3.geoPath().projection(projection),animationLength=3500,animationIconLength=animationLength/100;function setup(){drawGlobe(),drawGraticule(),enableRotation(),setTimeout((()=>{disableRotation(),document.getElementById("contact").classList.remove("hidden")}),animationLength)}function drawGlobe(){d3.queue().defer(d3.json,"https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/world-110m.json").await(((t,e)=>{svg.selectAll(".segment").data(topojson.feature(e,e.objects.countries).features).enter().append("path").attr("class","segment").attr("d",path).attr("width",width).attr("height",height).style("stroke",(()=>["#f0f0f0","#bdbdbd","#636363"][2*Math.random()|0])).style("stroke-width","1px").style("fill",(()=>["#f0f0f0","#bdbdbd","#636363"][2*Math.random()|0])).style("opacity",".6")}))}function drawGraticule(){const t=d3.geoGraticule();svg.append("path").datum(t).attr("class","graticule").attr("width",width).attr("height",height).attr("d",path).style("stroke","rgba(255,255,255,0.2)")}function enableRotation(){enableRotationPointer=d3.interval((t=>{projection.scale(null===md.mobile()?320:440).rotate([config.speed*t+2520,config.verticalTilt,config.horizontalTilt]).translate([width/2,height/2]),svg.selectAll("path").attr("d",path),drawMarkers()}))}function disableRotation(){d3.select("svg").remove(),enableRotationPointer.stop()}function drawMarkers(){function t(){let t=Math.round(Math.abs(projection.rotate()[0]));return t+=null===md.mobile()?"10.33":"30",t/80+"%"}let e=locations.map((e=>{let[o,a]=projection([e.longitude,e.latitude]);return{x:o,y:a,region:sameLocation?"We are in the same region":e.region,fontSize:t()}}));const o=markerGroup.selectAll("circle").data(e);o.enter().append("circle").merge(o).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill","#eee").attr("r",7);const a=textGroup.selectAll("text").data(e);a.enter().append("text").merge(a).attr("font-size",(t=>t.fontSize)).attr("fill","#fff").attr("font-family","Helvetica Neue").attr("font-weight","600").attr("x",(t=>t.x+15)).attr("y",(t=>t.y)).text((t=>t.region)),markerGroup.each((function(){this.parentNode.appendChild(this)})),textGroup.each((function(){this.parentNode.appendChild(this)})),console.log(locations)}function updateLoader(){with(ctx)clearRect(0,0,16,16),beginPath(),arc(8,8,6,C3,2*pct*Math.PI/100+C3),stroke();lnk.href=cv.toDataURL("image/png"),100!==pct?pct++:clearInterval(tc)}window.onresize=function(){disableRotation()},window.onload=function(){cv=document.querySelector("#cvl"),ctx=cv.getContext("2d"),ctx&&(C3=1.5*Math.PI,tc=pct=0,lnk=document.querySelector('link[rel*="icon"]'),ctx.lineWidth=2,ctx.strokeStyle="fuchsia",tc=setInterval(updateLoader,animationIconLength))};
